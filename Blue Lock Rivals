-- T·∫£i th∆∞ vi·ªán Rayfield
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Khai b√°o c√°c d·ªãch v·ª•
local Services = {
    Players = game:GetService("Players"),
    RunService = game:GetService("RunService"),
    ReplicatedStorage = game:GetService("ReplicatedStorage"),
    Workspace = game:GetService("Workspace"),
    VirtualInputManager = game:GetService("VirtualInputManager"),
    TeleportService = game:GetService("TeleportService"),
    HttpService = game:GetService("HttpService"),
    TweenService = game:GetService("TweenService"),
    CollectionService = game:GetService("CollectionService"),
    CoreGui = game:GetService("CoreGui")
}

-- Khai b√°o c√°c bi·∫øn c∆° b·∫£n
local player = Services.Players.LocalPlayer
local mouse = player:GetMouse()
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:FindFirstChild("Humanoid") or character:WaitForChild("Humanoid")
local humanoidrootpart = character:FindFirstChild("HumanoidRootPart") or character:WaitForChild("HumanoidRootPart")

-- Khai b√°o c√°c bi·∫øn Debris_Variables
local Debris_Variables = {
    Function_Variables = {
        getAllFromCollection = { taggedInstances = nil },
        GetBallInPlayer = { FootBall = nil },
        triggerQ = { Distance = nil },
        createBillboard = { BillboardGui = nil },
        createBarGui = { gui = nil, frame = nil },
        createBar = { BackgroundFrame = nil, FillFrame = nil },
        onCharacterAdded = {
            HumanoidRootPart = nil, styleGui = nil, styleTxt = nil, awakeGui = nil, awakeFrame = nil,
            flowGui = nil, flowFrame = nil, stamGui = nil, stamFrame = nil, awkBar = nil,
            flowBar = nil, stmBar = nil, Distance = nil, PlayerStats = nil
        },
        createESP = { espData = nil },
        warpBallToGoal = { ball = nil }
    },
    Modules = {},
    ESP_Features = {
        espEnabled = false,
        espFeatures = { Style = false, Awakening = false, Flow = false, Stamina = false },
        espObjects = {}
    },
    WalkSpeedToggle = { WalkSpeedConnect = nil },
	JumpPowerToggle = { JumpPowerConnect = nil },

    HitboxToggle = { FootBall = nil, HitBox = nil, Char = nil },
    HitboxKeybind = { State = false },
    AutoDribble = { tracked = {}, TargetPlayer = nil, Distance = nil, Sliding = nil, isSliding = false },
    vipToggle = { hasVIP = false },
    Raycast = {
        ball = nil, lastPosition = nil, GRAVITY = Services.Workspace.Gravity, TIME_STEP = 0.1,
        MAX_TIME = 3, VELOCITY_THRESHOLD = 1, MOVEMENT_THRESHOLD = 1, rayPart = nil, tween = nil
    },
    AutoGKKeybind = { State = false, ball = nil, Distance = nil },
    AutoTeamToggle = { selectedValue = nil, team = nil, position = nil },
    KaiserKeybide = { State = false },
    CurveShotProMaxKeybind = { State = false },
    NoCooldownStealToggle = { newSteal = nil },
    NoCooldownAirDribbleToggle = {},
    NoCooldownAirDashToggle = {}
}

-- T·∫°o c·ª≠a s·ªï ch√≠nh
local Window = Rayfield:CreateWindow({
   Name = "Noob Hub",
   Icon = 0, -- Icon in Topbar. Can use Lucide Icons (string) or Roblox Image (number). 0 to use no icon (default).
   LoadingTitle = "Noob hub",
   LoadingSubtitle = "nice script fr",
   Theme = "Default", -- Check https://docs.sirius.menu/rayfield/configuration/themes

   DisableRayfieldPrompts = false,
   DisableBuildWarnings = false, -- Prevents Rayfield from warning when the script has a version mismatch with the interface

   ConfigurationSaving = {
      Enabled = true,
      FolderName = nil, -- Create a custom folder for your hub/game
      FileName = "Big Hub"
   },

   Discord = {
      Enabled = false, -- Prompt the user to join your Discord server if their executor supports it
      Invite = "noinvitelink", -- The Discord invite code, do not include discord.gg/. E.g. discord.gg/ ABCD would be ABCD
      RememberJoins = true -- Set this to false to make them join the discord every time they load it up
   },

   KeySystem = true, -- Set this to true to use our key system
   KeySettings = {
      Title = "Key System",
      Subtitle = "Key System of Noob hub",
      Note = "Key is: NoobHub1234", -- Use this to tell the user how to get a key
      FileName = "Key", -- It is recommended to use something unique as other scripts using Rayfield may overwrite your key file
      SaveKey = true, -- The user's key will be saved, but if you change the key, they will be unable to use your script
      GrabKeyFromSite = false, -- If this is true, set Key below to the RAW site you would like Rayfield to get the key from
      Key = {"NoobHub1234"} -- List of keys that will be accepted by the system, can be RAW file links (pastebin, github etc) or simple strings ("hello","key22")
   }
})

-- T·∫°o c√°c tab
local LegitTab = Window:CreateTab("Legit")
local VisualTab = Window:CreateTab("üëÅÔ∏èVisual")
local OPTab = Window:CreateTab("‚öîÔ∏èOP")
local StyleTab = Window:CreateTab("‚ú®Style")
local TeamTab = Window:CreateTab("Team")
-- Khai b√°o c√°c h√†m ph·ª• tr·ª£
local Function_Storage = {}

Function_Storage.getAllFromCollection = function(tagName)
    Debris_Variables.Function_Variables.getAllFromCollection.taggedInstances = Services.CollectionService:GetTagged(tagName)
    return Debris_Variables.Function_Variables.getAllFromCollection.taggedInstances
end

Function_Storage.GetBall = function()
    for _, obj in pairs(Function_Storage.getAllFromCollection("Football")) do
        if obj.Name == "Football" and obj.Parent ~= Services.ReplicatedStorage.Assets then
            return obj
        end
    end
end

Function_Storage.UpdateHitboxSize = function(TargetHitbox, Transparency, HitboxSize)
    TargetHitbox.Material = Enum.Material.ForceField
    TargetHitbox.BrickColor = BrickColor.new("Neon orange")
    TargetHitbox.Transparency = Transparency
    TargetHitbox.Size = Vector3.new(HitboxSize, HitboxSize, HitboxSize)
end

-- ### Legit Tab UI Elements
LegitTab:CreateSection("Player Modifiers")

local WalkSpeedToggle = LegitTab:CreateToggle({
    Name = "WalkSpeed Toggle",
    CurrentValue = false,
    Flag = "WalkSpeedToggle",
    Callback = function(Value)
        task.spawn(function()
            if Value then
                Debris_Variables.WalkSpeedToggle.WalkSpeedConnect = humanoid:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
                    if humanoid.WalkSpeed ~= tonumber(Rayfield.Flags["WalkSpeedInput"].CurrentValue) then
                        humanoid.WalkSpeed = tonumber(Rayfield.Flags["WalkSpeedInput"].CurrentValue)
                    end
                end)
                task.spawn(function()
                    while Rayfield.Flags["WalkSpeedToggle"].CurrentValue do
                        task.wait(0.1)
                        if humanoid.WalkSpeed ~= tonumber(Rayfield.Flags["WalkSpeedInput"].CurrentValue) then
                            humanoid.WalkSpeed = tonumber(Rayfield.Flags["WalkSpeedInput"].CurrentValue)
                        end
                    end
                    if Debris_Variables.WalkSpeedToggle.WalkSpeedConnect then
                        Debris_Variables.WalkSpeedToggle.WalkSpeedConnect:Disconnect()
                        Debris_Variables.WalkSpeedToggle.WalkSpeedConnect = nil
                    end
                end)
            else
                if Debris_Variables.WalkSpeedToggle.WalkSpeedConnect then
                    Debris_Variables.WalkSpeedToggle.WalkSpeedConnect:Disconnect()
                    Debris_Variables.WalkSpeedToggle.WalkSpeedConnect = nil
                end
            end
        end)
    end,
})

local function getValidInput(input)
    if input and input ~= "" then
        return input
    else
        return "50"  -- gi√° tr·ªã m·∫∑c ƒë·ªãnh
    end
end

LegitTab:CreateInput({
    Name = "WalkSpeed Input",
    CurrentValue = "16",
    PlaceholderText = "Enter WalkSpeed",
    RemoveTextAfterFocusLost = false,
    Flag = "WalkSpeedInput",
    Callback = function(Value) end,
})

local JumpPowerToggle = LegitTab:CreateToggle({
    Name = "JumpPower Toggle",
    CurrentValue = false,
    Flag = "JumpPowerToggle",
    Callback = function(Value)
        task.spawn(function()
            if Value then
                Debris_Variables.JumpPowerToggle.JumpPowerConnect = humanoid:GetPropertyChangedSignal("JumpPower"):Connect(function()
                    local inputText = getValidInput(Rayfield.Flags["JumpPowerInput"].CurrentValue)
                    local newJumpPower = tonumber(inputText)
                    if humanoid.JumpPower ~= newJumpPower then
                        humanoid.JumpPower = newJumpPower
                    end
                end)
                task.spawn(function()
                    while Rayfield.Flags["JumpPowerToggle"].CurrentValue do
                        task.wait(0.1)
                        local inputText = getValidInput(Rayfield.Flags["JumpPowerInput"].CurrentValue)
                        local newJumpPower = tonumber(inputText)
                        if humanoid.JumpPower ~= newJumpPower then
                            humanoid.JumpPower = newJumpPower
                        end
                    end
                    if Debris_Variables.JumpPowerToggle.JumpPowerConnect then
                        Debris_Variables.JumpPowerToggle.JumpPowerConnect:Disconnect()
                        Debris_Variables.JumpPowerToggle.JumpPowerConnect = nil
                    end
                end)
            else
                if Debris_Variables.JumpPowerToggle.JumpPowerConnect then
                    Debris_Variables.JumpPowerToggle.JumpPowerConnect:Disconnect()
                    Debris_Variables.JumpPowerToggle.JumpPowerConnect = nil
                end
            end
        end)
    end,
})


LegitTab:CreateInput({
    Name = "JumpPower Input",
    CurrentValue = "50", -- gi√° tr·ªã m·∫∑c ƒë·ªãnh
    PlaceholderText = "Enter JumpPower",
    RemoveTextAfterFocusLost = false,
    Flag = "JumpPowerInput",
    Callback = function(Value)
        -- Ki·ªÉm tra n·∫øu Value nil ho·∫∑c r·ªóng, g√°n gi√° tr·ªã m·∫∑c ƒë·ªãnh
        if not Value or Value == "" then
            Rayfield.Flags["JumpPowerInput"].CurrentValue = "50"
        end
    end,
})



LegitTab:CreateSection("Hitbox")

local HitboxToggle = LegitTab:CreateToggle({
    Name = "Hitbox Toggle",
    CurrentValue = false,
    Flag = "HitboxToggle",
    Callback = function(Value)
        task.spawn(function()
            while Value do
                task.wait()
                Debris_Variables.HitboxToggle.FootBall = Function_Storage.GetBall()
                if Debris_Variables.HitboxToggle.FootBall then
                    Debris_Variables.HitboxToggle.HitBox = Debris_Variables.HitboxToggle.FootBall:FindFirstChild("Hitbox")
                    if Debris_Variables.HitboxToggle.HitBox and Debris_Variables.HitboxToggle.HitBox:IsA("Part") then
                        Function_Storage.UpdateHitboxSize(Debris_Variables.HitboxToggle.HitBox, 0.5, tonumber(Rayfield.Flags["HitboxInput"].CurrentValue))
                    end
                end
            end
            task.wait(0.1)
            if not Value and Debris_Variables.HitboxToggle.HitBox then
                Function_Storage.UpdateHitboxSize(Debris_Variables.HitboxToggle.HitBox, 1, 2.5)
            end
        end)
    end,
})

local Button = LegitTab:CreateButton({
   Name = "Infinite Yield",
   Callback = function()
   loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()
   end,
})

LegitTab:CreateInput({
    Name = "Hitbox Size",
    CurrentValue = "10",
    PlaceholderText = "Enter size (1-30)",
    RemoveTextAfterFocusLost = false,
    Flag = "HitboxInput",
    Callback = function(Value) end,
})

LegitTab:CreateKeybind({
    Name = "Hitbox Keybind",
    CurrentKeybind = "H",
    HoldToInteract = false,
    Flag = "HitboxKeybind",
    Callback = function(Key)
        task.spawn(function()
            Debris_Variables.HitboxKeybind.State = not Rayfield.Flags["HitboxToggle"].CurrentValue
            HitboxToggle:Set(Debris_Variables.HitboxKeybind.State)
        end)
    end,
})

LegitTab:CreateSection("Misc")

-- Kh·ªüi t·∫°o c√†i ƒë·∫∑t Auto Dribble n·∫øu ch∆∞a c√≥ (ƒë·∫∑t ·ªü ƒë·∫ßu script)
if not getgenv().AutoDribbleSettings then
    getgenv().AutoDribbleSettings = {
        Enabled = false, -- M·∫∑c ƒë·ªãnh t·∫Øt ƒë·ªÉ kh·ªõp v·ªõi toggle
        range = 22       -- Ph·∫°m vi m·∫∑c ƒë·ªãnh
    }
end

-- D·ªãch v·ª• c∆° b·∫£n (ƒë·∫∑t ·ªü ƒë·∫ßu script n·∫øu ch∆∞a c√≥)
local R = game:GetService("ReplicatedStorage")
local P = game:GetService("Players")
local U = game:GetService("RunService")
local L = P.LocalPlayer or P.PlayerAdded:Wait()

-- Th√™m Toggle Auto Dribble v·ªõi logic b√™n trong
LegitTab:CreateToggle({
    Name = "AutoDribble Toggle",
    CurrentValue = false,
    Flag = "AutoDribble",
    Callback = function(Value)
        getgenv().AutoDribbleSettings.Enabled = Value -- C·∫≠p nh·∫≠t tr·∫°ng th√°i Enabled
        
        if Value then
            -- Kh·ªüi t·∫°o nh√¢n v·∫≠t
            local function initCharacter()
                local C = L.Character or L.CharacterAdded:Wait()
                local H = C:WaitForChild("HumanoidRootPart")
                local M = C:WaitForChild("Humanoid")
                return C, H, M
            end
            local C, H, M = initCharacter()

            -- X·ª≠ l√Ω khi nh√¢n v·∫≠t thay ƒë·ªïi
            L.CharacterAdded:Connect(function(newChar)
                C, H, M = initCharacter()
            end)

            -- RemoteEvent v√† Animation
            local B = R.Packages.Knit.Services.BallService.RE.Dribble
            local A = require(R.Assets.Animations)

            -- H√†m t·∫£i animation r√™ b√≥ng
            local function G(s)
                if not A.Dribbles[s] then return nil end
                local I = Instance.new("Animation")
                I.AnimationId = A.Dribbles[s]
                return M and M:LoadAnimation(I)
            end

            -- Ki·ªÉm tra tr·∫°ng th√°i slide c·ªßa ng∆∞·ªùi ch∆°i kh√°c
            local function T(p)
                if p == L then return false end
                local c = p.Character
                if not c then return false end
                local V = c.Values and c.Values.Sliding
                if V and V.Value == true then return true end
                local h = c:FindFirstChildOfClass("Humanoid")
                if h and h.MoveDirection.Magnitude > 0 and h.WalkSpeed == 0 then return true end
                return false
            end

            -- Ki·ªÉm tra ƒë·ªôi kh√°c
            local function O(p)
                if not L.Team or not p.Team then return false end
                return L.Team ~= p.Team
            end

            -- H√†m r√™ b√≥ng
            local function D(d)
                if not getgenv().AutoDribbleSettings.Enabled or not C.Values.HasBall.Value then return end
                B:FireServer() -- G·ª≠i y√™u c·∫ßu r√™ b√≥ng
                local s = L.PlayerStats.Style.Value
                local t = G(s)
                if t then
                    t:Play()
                    t:AdjustSpeed(math.clamp(1 + (10 - d) / 10, 1, 2)) -- ƒêi·ªÅu ch·ªânh t·ªëc ƒë·ªô animation
                end
                local F = workspace:FindFirstChild("Football")
                if F then
                    F.AssemblyLinearVelocity = Vector3.new() -- Reset v·∫≠n t·ªëc b√≥ng
                    F.CFrame = C.HumanoidRootPart.CFrame * CFrame.new(0, -2.5, 0) -- ƒê·∫∑t b√≥ng d∆∞·ªõi ch√¢n
                end
            end

            -- V√≤ng l·∫∑p ch√≠nh ch·∫°y khi toggle b·∫≠t
            task.spawn(function()
                while Rayfield.Flags["AutoDribble"].CurrentValue do
                    if not C or not H then return end
                    for _, p in pairs(P:GetPlayers()) do
                        if O(p) and T(p) then
                            local r = p.Character and p.Character:FindFirstChild("HumanoidRootPart")
                            if r then
                                local d = (r.Position - H.Position).Magnitude
                                if d < getgenv().AutoDribbleSettings.range then
                                    D(d) -- Th·ª±c hi·ªán r√™ b√≥ng n·∫øu trong ph·∫°m vi
                                    break
                                end
                            end
                        end
                    end
                    task.wait(0.1) -- T·∫ßn su·∫•t ki·ªÉm tra
                end
            end)
        end
    end,
})


local vipToggle = LegitTab:CreateToggle({
    Name = "VIP Toggle",
    CurrentValue = false,
    Flag = "vipToggle",
    Callback = function(Value)
        task.spawn(function()
            Debris_Variables.vipToggle.hasVIP = player:FindFirstChild("HasVIP")
            if Debris_Variables.vipToggle.hasVIP then
                Debris_Variables.vipToggle.hasVIP.Value = Value
                if Value then
                    Rayfield:Notify({ Title = "VIP Activated", Content = "You are now a VIP! Enjoy your perks!", Duration = 3 })
                else
                    Rayfield:Notify({ Title = "VIP Deactivated", Content = "VIP status disabled. You lost your perks.", Duration = 3 })
                end
            else
                Rayfield:Notify({ Title = "Error", Content = "Could not find the 'HasVIP' property. Try Again.", Duration = 3 })
                vipToggle:Set(false)
            end
        end)
    end,
})

-- Kh·ªüi t·∫°o Settings n·∫øu ch∆∞a c√≥
if not getgenv().Settings then
    getgenv().Settings = {}
end

-- T·∫°o n√∫t Infinite Stamina trong LegitTab
LegitTab:CreateButton({
    Name = "Infinite Stamina",
    Callback = function()
        if not getgenv().Settings.InfiniteStamina then
            getgenv().Settings.InfiniteStamina = true
            -- Th√¥ng b√°o b·∫±ng Rayfield (t∆∞∆°ng t·ª± Fluent:Notify)
            Rayfield:Notify({
                Title = "Infinite Stamina",
                Content = "Enabled",
                Duration = 3
            })
            -- Ch·∫°y v√≤ng l·∫∑p ƒë·ªÉ duy tr√¨ stamina v√¥ h·∫°n
            task.spawn(function()
                while task.wait(0.1) do
                    if getgenv().Settings.InfiniteStamina then
                        pcall(function()
                            local plr = game.Players.LocalPlayer
                            local stats = plr:FindFirstChild("PlayerStats")
                            if stats then
                                local stamina = stats:FindFirstChild("Stamina")
                                if stamina then
                                    stamina:Destroy()
                                    local fakeStamina = Instance.new("NumberValue")
                                    fakeStamina.Name = "Stamina"
                                    fakeStamina.Value = math.huge
                                    fakeStamina.Parent = stats
                                end
                            end
                        end)
                    end
                end
            end)
        else
            Rayfield:Notify({
                Title = "Infinite Stamina",
                Content = "Already Enabled",
                Duration = 3
            })
        end
    end,
})



-- ### Visual Tab UI Elements
VisualTab:CreateSection("Visual Features")

-- ƒê·∫£m b·∫£o Debris_Variables ƒë√£ ƒë∆∞·ª£c khai b√°o (th√™m n·∫øu ch∆∞a c√≥)
local Debris_Variables = Debris_Variables or {}
Debris_Variables.ESP_Features = Debris_Variables.ESP_Features or {
    espEnabled = false,
    espFeatures = { Style = false, Awakening = false, Flow = false, Stamina = false },
    espObjects = {}
}

-- D·ªãch v·ª• c·∫ßn thi·∫øt (ƒë·∫∑t ·ªü ƒë·∫ßu script n·∫øu ch∆∞a c√≥)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- H√†m t·∫°o ESP cho m·ªôt nh√¢n v·∫≠t
local function createESP(player)
    if player == LocalPlayer or not player.Character then return end
    local character = player.Character
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end

    -- T·∫°o BillboardGui
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "ESP_" .. player.Name
    billboard.Adornee = humanoidRootPart
    billboard.Size = UDim2.new(0, 100, 0, 50)
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = game.CoreGui

    -- T·∫°o TextLabel cho t√™n
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, 0, 0, 20)
    nameLabel.Position = UDim2.new(0, 0, 0, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = player.Name
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.TextStrokeTransparency = 0
    nameLabel.Font = Enum.Font.SourceSansBold
    nameLabel.TextSize = 16
    nameLabel.Parent = billboard

    -- L∆∞u tr·ªØ ESP object
    Debris_Variables.ESP_Features.espObjects[player] = billboard
end

-- H√†m x√≥a ESP
local function removeESP(player)
    if Debris_Variables.ESP_Features.espObjects[player] then
        Debris_Variables.ESP_Features.espObjects[player]:Destroy()
        Debris_Variables.ESP_Features.espObjects[player] = nil
    end
end

-- Toggle Enable ESP
VisualTab:CreateToggle({
    Name = "Enable ESP",
    CurrentValue = false,
    Flag = "espToggle",
    Callback = function(Value)
        Debris_Variables.ESP_Features.espEnabled = Value
        if Value then
            -- T·∫°o ESP cho t·∫•t c·∫£ ng∆∞·ªùi ch∆°i hi·ªán t·∫°i
            for _, player in pairs(Players:GetPlayers()) do
                createESP(player)
            end
            -- Theo d√µi ng∆∞·ªùi ch∆°i m·ªõi
            Players.PlayerAdded:Connect(function(player)
                if Debris_Variables.ESP_Features.espEnabled then
                    player.CharacterAdded:Connect(function()
                        createESP(player)
                    end)
                end
            end)
            -- X√≥a ESP khi ng∆∞·ªùi ch∆°i r·ªùi
            Players.PlayerRemoving:Connect(function(player)
                removeESP(player)
            end)
            -- C·∫≠p nh·∫≠t li√™n t·ª•c (n·∫øu c·∫ßn)
            task.spawn(function()
                while Debris_Variables.ESP_Features.espEnabled do
                    for player, billboard in pairs(Debris_Variables.ESP_Features.espObjects) do
                        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                            billboard.Adornee = player.Character.HumanoidRootPart
                        else
                            removeESP(player)
                        end
                    end
                    task.wait(0.1)
                end
            end)
        else
            -- X√≥a t·∫•t c·∫£ ESP khi t·∫Øt
            for player, _ in pairs(Debris_Variables.ESP_Features.espObjects) do
                removeESP(player)
            end
        end
    end,
})

-- ### OP Tab UI Elements
OPTab:CreateSection("Striker")

local function ClosestCharacter(o, w)
    local c, d = nil, math.huge
    if not o or not o:FindFirstChild("HumanoidRootPart") then return nil end
    for _, m in ipairs((w or workspace):GetDescendants()) do
        if m:IsA("Model") and m ~= o and m:FindFirstChild("Humanoid") and m:FindFirstChild("HumanoidRootPart") and m:FindFirstChild("Football") then
            local dist = (o.HumanoidRootPart.Position - m.HumanoidRootPart.Position).Magnitude
            if dist < d then c, d = m, dist end
        end
    end
    return c
end

local function Goto(t, g, a)
    print("Goto called with target:", t, "goal:", g, "action:", a)
    if humanoidrootpart then
        humanoidrootpart.CFrame = t
        print("HumanoidRootPart CFrame set to:", t)
    else
        print("Error: humanoidrootpart is nil in Goto function!")
    end
    if a == "Slide" then
        game:GetService("ReplicatedStorage").Packages.Knit.Services.BallService.RE.Slide:FireServer()
        print("Slide event fired")
    elseif a == "Kick" then
        game:GetService("ReplicatedStorage").Packages.Knit.Services.BallService.RE.Shoot:FireServer(100, nil, nil, workspace.Goals[g].Position)
        task.wait(0.2)
        local ball = workspace:FindFirstChild("Football") or workspace:WaitForChild("Football", 5)
        if ball then
            local targetPos = (workspace.Goals[g].CFrame * CFrame.new(0, 0, 10)).Position
            repeat
                ball.CFrame = CFrame.new(targetPos)
                task.wait(0.1)
            until (ball.Position - targetPos).Magnitude < 0.2
        end
    end
end

OPTab:CreateToggle({
    Name = "Auto Goal",
    CurrentValue = false,
    Flag = "Toggle1",
    Callback = function(Value)
        getgenv().Settings = getgenv().Settings or {}
        getgenv().Settings.AutoFarmTeleportToggle = Value

        if Value then
            task.spawn(function()
                -- Function to handle the auto goal logic
                local function autoGoalLogic()
					print("autoGoalLogic called (Team:", player.Team.Name, ")")
					if player.Team.Name == "Visitor" then
						print("Player is on Visitor team, returning.")
						return
					end

					local character = player.Character
					if not character or not character:FindFirstChild("HumanoidRootPart") then
						print("Character or HumanoidRootPart not found.")
						return
					end
					local humanoidrootpart = character:WaitForChild("HumanoidRootPart")
					local humanoid = character:FindFirstChildOfClass("Humanoid")
					if not humanoid then
						print("Humanoid not found.")
						return
					end
					local v = character:FindFirstChild("Values") or character:WaitForChild("Values", 5)
					local h = v and (v:FindFirstChild("HasBall") or v:WaitForChild("HasBall", 5))
					local g = {["Away"] = "Away", ["Home"] = "Home"}

					local targetGoal = g[player.Team.Name]
					print("Target Goal:", targetGoal)

					if targetGoal then
						if h and h.Value then
							print("Player has the ball, kicking.")
							Goto(humanoidrootpart.CFrame * CFrame.new(0, 50, 0), targetGoal, "Kick")
						else
							local b = workspace:FindFirstChild("Football")
							print("Found Football:", b)
							if b then
								local targetCFrame = b.CFrame * CFrame.new(0, 3.5, 0)
								print("Target CFrame for Football:", targetCFrame)
								humanoidrootpart.CFrame = targetCFrame -- Quay l·∫°i ƒë·∫∑t CFrame tr·ª±c ti·∫øp
								print("HumanoidRootPart CFrame set to:", targetCFrame)
							else
								print("Football does not exist, trying to find closest player with ball.")
								local t = ClosestCharacter(character)
								print("Closest character:", t)
								local fb = t and t:FindFirstChild("Football") or (t and t:WaitForChild("Football", 5))
								print("Football of closest character:", fb)
								if fb then Goto(fb.CFrame, targetGoal, "Slide") end
							end
						end
					end
				end

                local function onTeamChanged()
                    if getgenv().Settings.AutoFarmTeleportToggle then
                        autoGoalLogic()
                    end
                end

                player:GetPropertyChangedSignal("Team"):Connect(onTeamChanged)

                while getgenv().Settings.AutoFarmTeleportToggle do
                    autoGoalLogic()
                    task.wait(0.1)
                end
            end)
        end
    end,
})

local AutoGoalTestToggle = OPTab:CreateToggle({
    Name = "Auto Goal (New)",
    CurrentValue = false,
    Flag = "AutoGoalTest",
    Callback = function(Value)
        getgenv().Settings = getgenv().Settings or {}
        getgenv().Settings.AutoGoalTestToggle = Value

        if Value then
            task.spawn(function()
                -- H√†m autoGoalLogic2 (t∆∞∆°ng t·ª± autoGoalLogic nh∆∞ng c√≥ th·ªÉ t√πy ch·ªânh th√™m)
                local function autoGoalLogic2()
                    print("autoGoalLogic2 called (Team:", player.Team.Name, ")")
                    if player.Team.Name == "Visitor" then
                        print("Player is on Visitor team, returning.")
                        return
                    end

                    local character = player.Character
                    if not character or not character:FindFirstChild("HumanoidRootPart") then
                        print("Character or HumanoidRootPart not found.")
                        return
                    end
                    local humanoidrootpart = character:WaitForChild("HumanoidRootPart")
                    local humanoid = character:FindFirstChildOfClass("Humanoid")
                    if not humanoid then
                        print("Humanoid not found.")
                        return
                    end
                    local v = character:FindFirstChild("Values") or character:WaitForChild("Values", 5)
                    local h = v and (v:FindFirstChild("HasBall") or v:WaitForChild("HasBall", 5))
                    local g = {["Away"] = "Away", ["Home"] = "Home"}

                    local targetGoal = g[player.Team.Name]
                    print("Target Goal:", targetGoal)

                    if targetGoal then
                        if h and h.Value then
                            print("Player has the ball, kicking.")
                            Goto(humanoidrootpart.CFrame * CFrame.new(0, 50, 0), targetGoal, "Kick")
                        else
                            local b = workspace:FindFirstChild("Football")
                            print("Found Football:", b)
                            if b then
                                local targetCFrame = b.CFrame * CFrame.new(0, 3.5, 0)
                                print("Target CFrame for Football:", targetCFrame)
                                humanoidrootpart.CFrame = targetCFrame
                                print("HumanoidRootPart CFrame set to:", targetCFrame)

                                -- Teleport qu·∫£ b√≥ng ƒë·∫øn g·∫ßn targetGoal
                                local goalPosition = workspace.Goals[targetGoal].Position
                                local ballTargetPos = goalPosition + Vector3.new(0, 3.5, 10)
                                b.CFrame = CFrame.new(ballTargetPos)
                                print("Football teleported to:", ballTargetPos)
                            else
                                print("Football does not exist, trying to find closest player with ball.")
                                local t = ClosestCharacter(character)
                                print("Closest character:", t)
                                local fb = t and t:FindFirstChild("Football") or (t and t:WaitForChild("Football", 5))
                                print("Football of closest character:", fb)
                                if fb then Goto(fb.CFrame, targetGoal, "Slide") end
                            end
                        end
                    end
                end

                local function onTeamChanged()
                    if getgenv().Settings.AutoGoalTestToggle then
                        autoGoalLogic2()
                    end
                end

                player:GetPropertyChangedSignal("Team"):Connect(onTeamChanged)

                while getgenv().Settings.AutoGoalTestToggle do
                    autoGoalLogic2()
                    task.wait(0.1)
                end
            end)
        end
    end,
})

local AutoGoalTestToggle = OPTab:CreateToggle({
    Name = "Auto Goal (test)",
    CurrentValue = false,
    Flag = "AutoGoalTest",
    Callback = function(Value)
        getgenv().Settings = getgenv().Settings or {}
        getgenv().Settings.AutoGoalTestToggle = Value

        local Players           = game:GetService("Players")
        local RunService        = game:GetService("RunService")
        local ReplicatedStorage = game:GetService("ReplicatedStorage")
        local player            = Players.LocalPlayer

        if Value then
            -- Start a per-frame loop for maximum speed
            getgenv().AutoGoalConnection = RunService.Heartbeat:Connect(function()
                local char = player.Character
                if not char then return end

                local hrp = char:FindFirstChild("HumanoidRootPart")
                if not hrp then return end

                local ball = workspace:FindFirstChild("Football")
                if not (ball and ball:IsA("BasePart")) then return end

                -- Determine opponent goal
                local goalKey = (player.Team.Name == "Home" and "Away") or (player.Team.Name == "Away" and "Home")
                local goalPart = workspace:FindFirstChild("Goals") and workspace.Goals:FindFirstChild(goalKey)
                if not goalPart then return end

                -- 1) Weld ball to HRP (if not already)
                if not hrp:FindFirstChild("AutoGoalWeld") then
                    local weld = Instance.new("WeldConstraint")
                    weld.Name  = "AutoGoalWeld"
                    weld.Part0 = hrp
                    weld.Part1 = ball
                    weld.Parent = hrp
                end

                -- 2) Move ball to arbitrary CFrame (gets pulled to HRP by weld)
                ball.CFrame = CFrame.new(0, 0, 0)

                -- 3) Teleport player (HRP) to the same spot
                hrp.CFrame = CFrame.new(0, 0, 0)

                -- 4) Kick
                ReplicatedStorage.Packages.Knit.Services.BallService.RE.Shoot:FireServer(
                    100, nil, nil, goalPart.Position
                )

                -- 5) Teleport player to opponent goal
                hrp.CFrame = CFrame.new(goalPart.Position + Vector3.new(0, 5, 0))
            end)
        else
            -- Stop the loop
            if getgenv().AutoGoalConnection then
                getgenv().AutoGoalConnection:Disconnect()
                getgenv().AutoGoalConnection = nil
            end

            -- Cleanup weld
            local ball = workspace:FindFirstChild("Football")
            if ball then
                local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    local weld = hrp:FindFirstChild("AutoGoalWeld")
                    if weld then weld:Destroy() end
                end
            end
        end
    end,
})







-- Input: save power value to getgenv() on change
local Input = OPTab:CreateInput({ 
   Name = "Power", 
   CurrentValue = 100, 
   PlaceholderText = "Enter power",
   RemoveTextAfterFocusLost = false,
   Flag = "PowerShoot", 
   Callback = function(Text)
      local power = tonumber(Text)
      if power then
         getgenv().PowerShootValue = power
      else
         warn("Invalid power input, keeping previous value or defaulting to 100")
         getgenv().PowerShootValue = 100
      end
   end,
})




local TrollTab = Window:CreateTab("üòàTroll") -- Title, Image

local Section = TrollTab:CreateSection("Fling")

local Button = TrollTab:CreateButton({
   Name = "Fling People",
   Callback = function()
	loadstring(game:HttpGet("https://pastefy.app/fFP2IgWN/raw"))()
   end,
})

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local FlingAllConnection


local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local FlingAllConnection

local FlingAllToggle = TrollTab:CreateToggle({
	Name = "Fling All(Reo/Kunigami required)",
	CurrentValue = false,
	Flag = "FlingAll",
	Callback = function(Value)
		local character = Players.LocalPlayer.Character
		if character and character:FindFirstChild("HumanoidRootPart") then
			character.HumanoidRootPart.Anchored = Value
		end

		if Value then
			FlingAllConnection = task.spawn(function()
				while true do
					for _, player in pairs(Players:GetPlayers()) do
						if player ~= Players.LocalPlayer then
							local args = {
								[1] = "BodyBlock",
								[2] = workspace:FindFirstChild(player.Name)
							}

							if args[2] then
								ReplicatedStorage:WaitForChild("Packages")
									:WaitForChild("Knit")
									:WaitForChild("Services")
									:WaitForChild("AbilityService")
									:WaitForChild("RE")
									:WaitForChild("Ability")
									:FireServer(unpack(args))
							end
						end
					end
					task.wait(0.25)
				end
			end)
		else
			if FlingAllConnection then
				pcall(function()
					task.cancel(FlingAllConnection)
				end)
			end

			-- Ensure unanchor again in case character reloaded during loop
			local char = Players.LocalPlayer.Character
			if char and char:FindFirstChild("HumanoidRootPart") then
				char.HumanoidRootPart.Anchored = false
			end
		end
	end,
})

local Section = TrollTab:CreateSection("Movesets")

local Button = TrollTab:CreateButton({
   Name = "Kaiser Dribble(no subj)",
   Callback = function()
    local Players = game:GetService("Players")
	local ReplicatedStorage = game:GetService("ReplicatedStorage")
	local UserInputService = game:GetService("UserInputService")

	local player = Players.LocalPlayer
	local character = player.Character or player.CharacterAdded:Wait()
	local camera = workspace.CurrentCamera

	-- UI setup
	local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
	gui.Name = "KaiserDribbleUI"
	gui.ResetOnSpawn = false

	local frame = Instance.new("Frame", gui)
	frame.Size = UDim2.new(0, 140, 0, 60)
	frame.Position = UDim2.new(1, -150, 1, -70)
	frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	frame.BackgroundTransparency = 0.2
	frame.Active = true
	frame.Draggable = true

	local button = Instance.new("TextButton", frame)
	button.Size = UDim2.new(1, 0, 1, 0)
	button.Position = UDim2.new(0, 0, 0, 0)
	button.Text = "Dribble"
	button.BackgroundColor3 = Color3.fromRGB(60, 120, 255)
	button.TextColor3 = Color3.new(1, 1, 1)
	button.TextScaled = true
	button.AutoButtonColor = true

	-- Show only on mobile
	button.Visible = UserInputService.TouchEnabled

	-- Find nearest visible player in front
	local function getClosestVisiblePlayer()
		local minDistance = math.huge
		local closest = nil
		local root = character:FindFirstChild("HumanoidRootPart")

		for _, other in ipairs(Players:GetPlayers()) do
			if other ~= player and workspace:FindFirstChild(other.Name) then
				local otherChar = workspace[other.Name]
				local otherRoot = otherChar:FindFirstChild("HumanoidRootPart")
				if otherRoot then
					local dirToPlayer = (otherRoot.Position - root.Position).Unit
					local facing = root.CFrame.LookVector
					if facing:Dot(dirToPlayer) > 0.5 then
						local screenPos, onScreen = camera:WorldToViewportPoint(otherRoot.Position)
						if onScreen then
							local distance = (otherRoot.Position - root.Position).Magnitude
							if distance < minDistance then
								minDistance = distance
								closest = other
							end
						end
					end
				end
			end
		end
		return closest
	end

	-- Trigger skill
	local function triggerDribble()
		local target = getClosestVisiblePlayer()
		if target then
			button.Text = "Dribbling..."
			button.AutoButtonColor = false
			button.BackgroundTransparency = 0.5
			button.TextTransparency = 0.5

			task.wait(0.2) -- cooldown/delay

			local args = {
				[1] = "KaiserDribble",
				[2] = {
					["State"] = "Off-Ball",
					["Action"] = "Dribble",
					["Object"] = workspace:WaitForChild(target.Name)
				}
			}
			ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Knit")
				:WaitForChild("Services"):WaitForChild("AbilityService")
				:WaitForChild("RE"):WaitForChild("Ability"):FireServer(unpack(args))

			-- Reset button
			button.Text = "Dribble"
			button.AutoButtonColor = true
			button.BackgroundTransparency = 0
			button.TextTransparency = 0
		end
	end

	-- PC keybind
	UserInputService.InputBegan:Connect(function(input, processed)
		if processed then return end
		if input.KeyCode == Enum.KeyCode.V then
			triggerDribble()
		end
	end)

	-- Mobile button
	button.MouseButton1Click:Connect(triggerDribble)
   end,
})



-- ### Style Tab UI Elements
StyleTab:CreateSection("Style")
local chosenStyle = "Isagi" -- Gi√° tr·ªã kh·ªüi t·∫°o l√† string
local chosenFlow = "Puzzle"

StyleTab:CreateDropdown({
    Name = "Style",
    Options = {"Isagi", "Chigiri", "Bachira", "Otoya", "Hiori", "Gagamaru", "King", "Nagi", "Reo", "Karasu", "Shidou", "Kunigami", "Sae", "Aiku", "Rin", "Yukimiya", "Don Lorenzo", "Kaiser", "NEL Isagi"},
    CurrentOption = chosenStyle, -- Gi√° tr·ªã m·∫∑c ƒë·ªãnh l√† string
    MultipleOptions = false, -- Ch·ªâ ch·ªçn m·ªôt gi√° tr·ªã
    Flag = "StyleLockDropdown",
    Callback = function(Options) 
        chosenStyle = Options[1] -- L·∫•y ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n t·ª´ table, s·∫Ω l√† string
    end,
})

local Button = StyleTab:CreateButton({
    Name = "Use Style",
    Callback = function()
        game:GetService("Players").LocalPlayer.PlayerStats.Style.Value = chosenStyle
    end,
})

local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StyleTab = StyleTab -- Gi·∫£ s·ª≠ StyleTab ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a tr∆∞·ªõc

-- L·∫•y ƒë·ªëi t∆∞·ª£ng AbilityCooldowns
local abilityCooldowns = ReplicatedStorage:FindFirstChild("AbilityCooldowns")

-- Table ƒë·ªÉ l∆∞u gi√° tr·ªã g·ªëc c·ªßa c√°c attributes
local originalAttributes = {}

-- H√†m l∆∞u gi√° tr·ªã g·ªëc c·ªßa attributes
local function saveOriginalAttributes()
    if abilityCooldowns then
        for attrName, attrValue in pairs(abilityCooldowns:GetAttributes()) do
            originalAttributes[attrName] = attrValue
        end
    end
end

-- H√†m kh√¥i ph·ª•c gi√° tr·ªã g·ªëc c·ªßa attributes
local function restoreOriginalAttributes()
    if abilityCooldowns then
        for attrName, originalValue in pairs(originalAttributes) do
            abilityCooldowns:SetAttribute(attrName, originalValue)
        end
    end
end

-- H√†m ƒë·∫∑t t·∫•t c·∫£ attributes th√†nh 0
local function setAttributesToZero()
    if abilityCooldowns then
        for attrName, _ in pairs(abilityCooldowns:GetAttributes()) do
            abilityCooldowns:SetAttribute(attrName, 0)
        end
    end
end

-- Bi·∫øn ƒë·ªÉ theo d√µi k·∫øt n·ªëi Heartbeat
local heartbeatConnection = nil

-- T·∫°o Toggle
local Toggle = StyleTab:CreateToggle({
    Name = "No Cooldown",
    CurrentValue = false,
    Flag = "NoCooldownToggle", -- ƒê·∫£m b·∫£o flag duy nh·∫•t n·∫øu d√πng l∆∞u c·∫•u h√¨nh
    Callback = function(Value)
        if Value then -- Khi Toggle ƒë∆∞·ª£c b·∫≠t
            -- L∆∞u gi√° tr·ªã g·ªëc n·∫øu ch∆∞a l∆∞u
            if next(originalAttributes) == nil then
                saveOriginalAttributes()
            end
            -- B·∫Øt ƒë·∫ßu ch·∫°y li√™n t·ª•c b·∫±ng Heartbeat
            if not heartbeatConnection then
                heartbeatConnection = RunService.Heartbeat:Connect(setAttributesToZero)
            end
        else -- Khi Toggle ƒë∆∞·ª£c t·∫Øt
            -- Ng·∫Øt k·∫øt n·ªëi Heartbeat
            if heartbeatConnection then
                heartbeatConnection:Disconnect()
                heartbeatConnection = nil
            end
            -- Kh√¥i ph·ª•c gi√° tr·ªã g·ªëc
            restoreOriginalAttributes()
        end
    end,
})

StyleTab:CreateSection("Flow")

StyleTab:CreateDropdown({
    Name = "Flow Lock",
    Options = {"Ice", "Lightning", "Puzzle", "Monster", "Gale Burst", "Genius", "King's Instinct", "Trap", "Crow", "Demon Wings", "Chameleon", "Wild Card", "Snake", "Prodigy", "Awakened Genius", "Dribbler"},
    CurrentOption = {},
    MultipleOptions = false,
    Flag = "FlowLockDropdown",
    Callback = function(Options) 
		chosenFlow = Options[1]
	end,
})

local Button = StyleTab:CreateButton({
   Name = "Use Flow",
   Callback = function()
   game:GetService("Players").LocalPlayer.PlayerStats.Flow.Value=chosenFlow
   end,
})

-- Team Tab
chosenTeam = nil
autoChooseEnabled = false

-- Dropdown ch·ªçn team
TeamTab:CreateDropdown({
    Name = "Auto Team",
    Options = {"Home_LW", "Home_RW", "Home_CM", "Home_CF", "Home_GK", "Away_LW", "Away_RW", "Away_CM", "Away_CF", "Away_GK"},
    CurrentOption = chosenTeam,
    MultipleOptions = false,
    Flag = "TeamDropdown",
    Callback = function(Options) 
        chosenTeam = Options[1]
        
        -- N·∫øu toggle ƒëang b·∫≠t th√¨ th·ª±c hi·ªán FireServer ngay khi ch·ªçn team m·ªõi
        if autoChooseEnabled and chosenTeam then
            local teamSide, position = string.match(chosenTeam, "(%w+)_(%w+)")
            if teamSide and position then
                local args = {
                    [1] = teamSide,
                    [2] = position
                }
                game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("Knit")
                    :WaitForChild("Services"):WaitForChild("Packages"):WaitForChild("TeamService")
                    :WaitForChild("RE"):WaitForChild("Select"):FireServer(unpack(args))
            end
        end
    end,
})

-- Toggle b·∫≠t/t·∫Øt auto choose
TeamTab:CreateToggle({
    Name = "Auto Choose",
    CurrentValue = false,
    Flag = "AutoChooseToggle",
    Callback = function(Value)
        autoChooseEnabled = Value

        -- N·∫øu b·∫≠t toggle v√† ƒë√£ ch·ªçn team th√¨ th·ª±c hi·ªán FireServer ngay l·∫≠p t·ª©c
        if autoChooseEnabled and chosenTeam then
            local teamSide, position = string.match(chosenTeam, "(%w+)_(%w+)")
            if teamSide and position then
                local args = {
                    [1] = teamSide,
                    [2] = position
                }
                game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("Knit")
                    :WaitForChild("Services"):WaitForChild("Packages"):WaitForChild("TeamService")
                    :WaitForChild("RE"):WaitForChild("Select"):FireServer(unpack(args))
            end
        end
    end,
})



-- Kh·ªüi ƒë·ªông script
Rayfield:LoadConfiguration()
